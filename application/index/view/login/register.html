{extend name="index-layout" /}{block name="pagecss"}<link rel="stylesheet" href="__STATIC__/index/css/style_tr.css"><link rel="stylesheet" href="__STATIC__/index/css/register.css">{/block}{block name="content"}<div class="banner">    <div class="wrapper">        <h2 class="wow fadeInUp">商户注册</h2>        <p class="wow fadeInUp" data-wow-delay='.5s'>- User Register -</p>    </div></div><div class="login1">    <div class="login-wp">        <div class=" login-hd">            <h2>欢迎注册</h2>        </div>        <div class="login-bd">            <form id="form2">                <div class="account-main c-center">                    <div>                        <div class="account-input-cont c-relative">                            <input id="regist-email" type="text" placeholder="邮箱" autocomplete="off" class="account-input">                            <div class="c-input-checked-icon c-hide regist-email-checked"></div>                        </div>                        <div id="email-tip" class="account-tip-cont">                            <div class="c-error-icon c-hide"></div>                            <div class="c-tip-text">请输入您的邮箱地址</div>                        </div>                    </div>                    <div>                        <div class="account-input-cont c-relative">                            <input id="regist-psw" type="password" placeholder="密码" autocomplete="off" class="account-input account-input-error">                            <div class="c-input-checked-icon c-hide regist-psw-checked"></div>                        </div>                        <!-- <div class="password-type-con">                            <div class="password-type-btn"></div>                            <div class="password-type-btn"></div>                            <div class="password-type-btn"></div>                            <div class="password-type-text"></div>                        </div> -->                        <div id="account-psw-tip" class="c-hide">                            <div class="c-tip-cont psw-check1">                                <div class="c-tip-icon"></div>                                <div class="c-tip-text-black">不能包含空格或特殊字符</div>                            </div>                            <div class="c-tip-cont psw-check2">                                <div class="c-tip-icon"></div>                                <div class="c-tip-text-black">长度6-18位</div>                            </div>                            <div class="c-tip-cont psw-check3">                                <div class="c-tip-icon"></div>                                <div class="c-tip-text-black">包含数字、大写和小写字母</div>                            </div>                        </div>                    </div>                    <!---授权给某个管理员开始--->                    {if condition="!empty($padmins)"}                        <div>                            <div class="account-input-cont c-relative">                                <select id="regist-padmin" class="account-input">                                    <option value="{:config('paofen_super_admin_id')}-">--选择接入到管理员--</option>                                    {foreach name="$padmins" item='v' key=>'k'}                                       <option value="{$v.padmin_id}-{$v.app_key}">{$v.username}</option>                                    {/foreach}                                </select>                                <div class="c-input-checked-icon c-hide regist-email-checked"></div>                            </div>                        </div>                    {/if}                    <!---授权给某个管理员结束--->                    <!--<div>-->                        <!--<div id="captcha-box" style="margin-top: 20px;margin-bottom: 10px;"><div class="geetest_holder geetest_wind geetest_detect" style="width: 100%;"><div class="geetest_form"><input type="hidden" name="geetest_challenge"><input type="hidden" name="geetest_validate"><input type="hidden" name="geetest_seccode"></div><div class="geetest_btn"><div class="geetest_radar_btn"><div class="geetest_radar"><div class="geetest_ring"><div class="geetest_small"></div></div><div class="geetest_sector" style="transform: rotate(74.2769deg);"><div class="geetest_small"></div></div><div class="geetest_cross"><div class="geetest_h"></div><div class="geetest_v"></div></div><div class="geetest_dot"></div><div class="geetest_scan"><div class="geetest_h"></div></div><div class="geetest_status"><div class="geetest_bg"></div><div class="geetest_hook"></div></div></div><div class="geetest_ie_radar"></div><div class="geetest_radar_tip" tabindex="0" aria-label="点击按钮进行验证" style="outline-width: 0px;"><span class="geetest_radar_tip_content">点击按钮进行验证</span><span class="geetest_reset_tip_content">请点击重试</span><span class="geetest_radar_error_code"></span></div><a class="geetest_logo" target="_blank" href="http://www.geetest.com/first_page"></a><div class="geetest_other_offline geetest_offline"></div></div><div class="geetest_ghost_success"><div class="geetest_success_btn"><div class="geetest_success_box"><div class="geetest_success_show"><div class="geetest_success_pie"></div><div class="geetest_success_filter"></div><div class="geetest_success_mask"></div></div><div class="geetest_success_correct"><div class="geetest_success_icon"></div></div></div><div class="geetest_success_radar_tip"><span class="geetest_success_radar_tip_content"></span><span class="geetest_success_radar_tip_timeinfo"></span></div><a class="geetest_success_logo" target="_blank" href="http://www.geetest.com/first_page"></a><div class="geetest_success_offline geetest_offline"></div></div></div><div class="geetest_slide_icon"></div></div><div class="geetest_wait"><span class="geetest_wait_dot geetest_dot_1"></span><span class="geetest_wait_dot geetest_dot_2"></span><span class="geetest_wait_dot geetest_dot_3"></span></div><div class="geetest_fullpage_click"><div class="geetest_fullpage_ghost"></div><div class="geetest_fullpage_click_wrap"><div class="geetest_fullpage_click_box"></div><div class="geetest_fullpage_pointer"><div class="geetest_fullpage_pointer_out"></div><div class="geetest_fullpage_pointer_in"></div></div></div></div><div class="geetest_goto" style="display: none;"><div class="geetest_goto_ghost"></div><div class="geetest_goto_wrap"><div class="geetest_goto_content"><div class="geetest_goto_content_tip"></div></div><div class="geetest_goto_cancel"></div><a class="geetest_goto_confirm"></a></div></div><div class="geetest_panel"><div class="geetest_panel_ghost"></div><div class="geetest_panel_box"><div class="geetest_other_offline geetest_panel_offline"></div><div class="geetest_panel_loading"><div class="geetest_panel_loading_icon"></div><div class="geetest_panel_loading_content"></div></div><div class="geetest_panel_success"><div class="geetest_panel_success_box"><div class="geetest_panel_success_show"><div class="geetest_panel_success_pie"></div><div class="geetest_panel_success_filter"></div><div class="geetest_panel_success_mask"></div></div><div class="geetest_panel_success_correct"><div class="geetest_panel_success_icon"></div></div></div><div class="geetest_panel_success_title"></div></div><div class="geetest_panel_error"><div class="geetest_panel_error_icon"></div><div class="geetest_panel_error_title"></div><div class="geetest_panel_error_content"></div><div class="geetest_panel_error_code"></div></div><div class="geetest_panel_footer"><div class="geetest_panel_footer_logo"></div><div class="geetest_panel_footer_copyright"></div></div><div class="geetest_panel_next"></div></div></div></div></div>-->                        <!--<div id="machine-verify-tip" class="account-tip-cont c-hide">-->                            <!--<div class="c-error-icon"></div>-->                            <!--<div class="c-tip-text c-error-text"></div>-->                        <!--</div>-->                    <!--</div>-->                <!---    <div id="tel-cont" class="c-hide">                        <div>                            <div class="account-tel-cont">                                <div class="account-free-btn">绑定手机号</div>                                <input type="text" placeholder="手机号码" autocomplete="off" class="account-tel">                                <div class="c-input-checked-icon c-hide"></div>                            </div>                            <div id="tel-tip" class="account-tip-cont c-hide">                                <div class="c-error-icon"></div>                                <div class="c-tip-text c-error-text"></div>                            </div>                        </div>                        <div id="verify-cont">                            <div class="account-verify-cont">                                <input type="text" placeholder="短信验证码" autocomplete="off" class="account-verify-input">                                <div class="account-verify-btn c-btn-primary account-verify-btn-disable">发送短信验证码</div>                            </div>                            <div id="verify-tip" class="account-tip-cont c-hide">                                <div class="c-error-icon"></div>                                <div class="c-tip-text c-error-text"></div>                            </div>                        </div>                    </div>-->                    <div class="login-btn">                        <input type="button" class="btn account-regist-btn account-regist-btn-disabled" value="立即注册">                    </div>                    <div class="c-clear">                        <div class="account-protocol">                            <div id="checked" class="c-checkbox c-checkbox-checked"></div>                            <div>我已阅读并同意相关<span onclick="window.open('/protocol')">服务条款和隐私政策</span></div>                        </div>                    </div>                    <div class="account-protocol-tip-cont c-hide">                        <div id="account-protocol-tip">                            <div class="c-error-icon"></div>                            <div class="c-tip-text c-error-text">请先同意服务条款</div>                        </div>                    </div>                    <div class="login-ft">                        以有账号？请<a href="/login.html?form=register" >立即登录</a>                    </div>                </div>            </form>        </div>    </div></div>{/block}{block name="pagejs"}<script src="__INDEX__/js/gt.js"></script><script type="text/javascript">    $(function () {        var time = 60;        var emailCheck = false;        var passwordCheck = false;        var telCheck = false;        var verifyCheck = false;        var checkboxCheck = true;        var geetestCheck = false;        $('#regist-email').focus();        var handler = function (captchaObj) {            $('#captcha-box').empty();            captchaObj.appendTo('#captcha-box');            captchaObj.onSuccess(function () {                var result = captchaObj.getValidate();                $.ajax({                    url: "{:url('index/Login/checkGeetest')}",                    type: 'POST',                    dataType: 'json',                    data: {                        geetest_challenge: result.geetest_challenge,                        geetest_validate: result.geetest_validate,                        geetest_seccode: result.geetest_seccode                    }                })                    .done(function (data1) {                        if (data1.status == "success") {                            geetestCheck = true;                            $('#tel-cont').show();                            $('#machine-verify-tip').hide();                        }                        else {                            layer.msg("验证失败，请重新验证！");                            geetestInit();                        }                    })                    .fail(function () {                        console.log("error");                    });            });            window.gt = captchaObj;        };        var geetestInit = function () {            $.ajax({                url: "{:url('index/Login/startGeetest')}",                type: 'GET',                dataType: 'json',            })                .done(function (data) {                    let product = 'popup';                    initGeetest({                        gt: data.gt,                        challenge: data.challenge,                        offline: !data.success,                        new_captcha: true,                        product: product,                        width: "100%"                    }, handler)                })                .fail(function () {                    console.log("error");                });        };        geetestInit();        $(".c-checkbox").click(function (event) {            if ($(this).attr('id') == "check") {                $(this).attr('id', 'checked');                $(this).removeClass('c-checkbox');                $(this).addClass('c-checkbox-checked');                $(".account-protocol-tip-cont").hide();                checkboxCheck = true;            }            else {                $(this).attr('id', 'check');                $(this).removeClass('c-checkbox-checked');                $(this).addClass('c-checkbox');                $(".account-protocol-tip-cont").show();                checkboxCheck = false;            }            registerBtnCheck();        });        function emailFn(email) {            var tel = $('.account-tel').val();            email = $.trim(email);            if (email != "") {                if (!EmailCheck(email)) {                    $("#email-tip .c-error-icon").show();                    $("#email-tip .c-tip-text").addClass('c-error-text');                    $("#email-tip .c-tip-text").html("请输入正确的邮箱");                    $(".regist-email-checked").hide();                    $("#regist-email").addClass('account-input-error');                    emailCheck = false;                    $('#email-tip').show();                    // telephoneFn(tel);                }                else {                    $.post("{:url('index/Login/checkUser')}",                        {                            username: email                        },                        function (data, textStatus, xhr) {                            console.log(data, textStatus, xhr);                            //data = JSON.parse(data);                            if (data.code == 1) {                                $("#email-tip .c-error-icon").hide();                                $("#email-tip .c-tip-text").removeClass('c-error-text');                                $("#email-tip .c-tip-text").html("请输入您的邮箱地址");                                $(".regist-email-checked").show();                                $("#regist-email").removeClass('account-input-error');                                emailCheck = true;                                $('#email-tip').hide();                            }                            else {                                $("#email-tip .c-error-icon").show();                                $("#email-tip .c-tip-text").addClass('c-error-text');                                $("#email-tip .c-tip-text").html(data.msg);                                $(".regist-email-checked").hide();                                $("#regist-email").addClass('account-input-error');                                emailCheck = false;                                $('#email-tip').show();                            }                            // telephoneFn(tel);                            verifyBtnCheck();                            registerBtnCheck();                        });                }            }            else {                $("#email-tip .c-error-icon").show();                $("#email-tip .c-tip-text").addClass('c-error-text');                $(".regist-email-checked").hide();                $("#regist-email").addClass('account-input-error');                emailCheck = false;                $('#email-tip').show();            }            registerBtnCheck();        }        function telephoneFn(tel) {            if (teleCheck(tel)) {                $.ajax({                    url:  "{:url('index/Login/checkPhone')}",                    type: 'POST',                    dataType: 'json',                    data: {                        phone: tel                    }                })                    .done(function (data) {                        if(data.code ==1){                            $('#tel-tip').hide();                            $('#verify-cont').show();                            $('.account-tel').removeClass('account-tel-error');                            $('.account-tel-cont .c-input-checked-icon').show();                            telCheck = true;                            if (emailCheck && time == 60) {                                $('.account-verify-btn').removeClass('account-verify-btn-disable');                                verifyCanSend = true;                            }                        }else{                            $('#tel-tip .c-error-text').html(data.msg);                            $('.account-tel').addClass('account-tel-error');                            $('.account-tel-cont .c-input-checked-icon').hide();                            $('#tel-tip').show();                            telCheck = false;                            $('.account-verify-btn').addClass('account-verify-btn-disable');                            verifyCanSend = false;                        }                    })                    .fail(function () {                        console.log("error");                    });            }            else {                $('#tel-tip .c-error-text').html("请输入正确的手机号码");                $('.account-tel').addClass('account-tel-error');                $('.account-tel-cont .c-input-checked-icon').hide();                $('#tel-tip').show();                telCheck = false;                $('.account-verify-btn').addClass('account-verify-btn-disable');                verifyCanSend = false;            }            registerBtnCheck();        }        $("#regist-email").bind('input propertychange', function (event) {            var email = $(this).val();            emailFn(email);        });        $("#regist-psw").focus(function (event) {            $("#account-psw-tip").show();            passwordTip(passwordType($("#regist-psw").val()));            //$('.password-type-con').show();        });        $("#regist-psw").blur(function (event) {            if (passwordCheck) {                $("#account-psw-tip").hide();                $('#regist-psw').removeClass('account-input-error');                passwordTip(passwordType($("#regist-psw").val()));                //$('.password-type-con').hide();            }            else {                $('#regist-psw').addClass('account-input-error');            }            registerBtnCheck();        });        $("#regist-psw").bind('input propertychange', function () {            passwordTip(passwordType($("#regist-psw").val()));            //$('.password-type-con').show();            var psw = $("#regist-psw").val();            var check1 = false;            var check2 = false;            var check3 = false;            console.log(psw);            //空格校验            var charReg = /[^a-zA-Z0-9,\.<>/?;:'\"\[\]\{\}\|\\`~!@#\$%\^&\*\(\)_\+-=]+/;            if (psw.length == 0) {                $(".psw-check1 .c-tip-icon").removeClass('c-tip-icon-correct');                check1 = false;            }            else if ((psw.indexOf(" ") == -1) && !charReg.test(psw)) {                $(".psw-check1 .c-tip-icon").addClass('c-tip-icon-correct');                check1 = true;            }            else {                $(".psw-check1 .c-tip-icon").removeClass('c-tip-icon-correct');                check1 = false;            }            //长度校验            if ((psw.length >= 6) && (psw.length <= 18)) {                $(".psw-check2 .c-tip-icon").addClass('c-tip-icon-correct');                check2 = true;            }            else {                $(".psw-check2 .c-tip-icon").removeClass('c-tip-icon-correct');                check2 = false;            }            //数字、大小写字母校验            var numAndLetterReg = /^(?=.*?[A-Z])(?=.*?[a-z])(?=.*?[0-9])/;            if (numAndLetterReg.test(psw)) {                $(".psw-check3 .c-tip-icon").addClass('c-tip-icon-correct');                check3 = true;            }            else {                $(".psw-check3 .c-tip-icon").removeClass('c-tip-icon-correct');                check3 = false;            }            if (check1 && check2 && check3) {                $(".regist-psw-checked").show();                passwordCheck = true;            }            else {                $(".regist-psw-checked").hide();                passwordCheck = false;            }        });        var verifyCanSend = false;        $('.account-tel').bind('input propertychange', function (event) {            var tel = $(this).val();          // 去掉手机验证 telephoneFn(tel);        });        $('.account-tel').blur(function (event) {            var tel = $(this).val();        //  去掉手机验证  telephoneFn(tel);        });        function verifyBtnCheck() {            if (emailCheck && telCheck) {                $('.account-verify-btn').removeClass('account-verify-btn-disable');                verifyCanSend = true;            }            else {                $('.account-verify-btn').addClass('account-verify-btn-disable');                verifyCanSend = false;            }        }        var verifyDisabled = false;        //发送验证码event        $('.account-verify-btn').click(function (event) {            var mobile = $('.account-tel').val();            var email = $('#regist-email').val();            if (geetestCheck) {                $('#machine-verify-tip').hide();                if (!verifyDisabled && verifyCanSend) {                    var inter = setInterval(function () {                        if (time <= 0) {                            clearInterval(inter);                            $('.account-verify-btn').removeClass('account-verify-btn-disable');                            $('.account-verify-btn').html("发送短信验证码");                            time = 60;                            verifyDisabled = false;                        }                        else {                            $('.account-verify-btn').addClass('account-verify-btn-disable');                            $('.account-verify-btn').html(time + "s后重新发送");                            verifyDisabled = true;                            time = time - 1;                        }                    }, 1000);                    $.post(                        "{:url('index/Login/sendSmsCode')}",                        {                            'phone': mobile                        },                        function (data, textStatus, xhr) {                            if (data.code == 1) {                                $('#verify-tip').hide();                                $('#verify-tip-normal').show();                            }                            else {                                $('#verify-tip-normal').hide();                                $('#verify-tip .c-error-text').html(data.msg);                                $('#verify-tip').show();                            }                        });                }            }            else {                $('#machine-verify-tip .c-error-text').html("请先完成验证");                $('#machine-verify-tip').show();            }        });        function registerFn() {            var email = $.trim($('#regist-email').val());            var password = $('#regist-psw').val();            var mobile = $('.account-tel').val();            var verifyCode = $('.account-verify-input').val();            var p_admin = $('#regist-padmin').val();            var registerParams = {                account: email,                password: password,                phone: mobile,                vercode: verifyCode,                p_admin: p_admin,            };            var url = window.location.href;            if (url.indexOf("mtid=") != -1) {                var mtid = (((url.split("?"))[1]).split("="))[1];                registerParams.geet_id = mtid;            }            if (emailCheck && passwordCheck) {            //if (emailCheck && passwordCheck && telCheck && verifyCheck && checkboxCheck && geetestCheck) { 去掉手机验证                console.log('xhr');                $.post(                    "{:url('index/Login/register')}",                    registerParams,                    function (data, textStatus, xhr) {                        console.log('result',data, textStatus, xhr);                        $('#verify-tip-normal').hide();                        if (data.code == 1) {                            layui.use('layer', function(){                                var layer = layui.layer;                                layer.alert('恭喜你，注册成功！', {                                    closeBtn: 0                                }, function(){                                    window.location.href = "/login.html";                                });                            });                        }else{                            $('#verify-tip .c-error-text').html(data.msg);                            $('#verify-tip').show();                            verifyCheck = false;                        }                    });            }        }        $('.account-regist-btn').click(function (event) {            registerFn();        });        $('.account-verify-input').bind('input propertychange', function (event) {            var verifyCode = $(this).val();            if (verifyCode == "") {                $(this).addClass('account-input-error');                verifyCheck = false;            } else {                $(this).removeClass('account-input-error');                verifyCheck = true;            }            registerBtnCheck();        });        $('.account-verify-input').keyup(function (event) {            if (event.keyCode == 13) {                registerFn();            }        });        function init() {            var emial = $('#regist-email').val();            var tel = $('.account-tel').val();            emailFn(emial);            telephoneFn(tel);        }        //邮箱校验        function EmailCheck(email) {            var EmailReg = /^[a-zA-Z0-9_\-\.]+@[a-zA-Z0-9_-]+(\.[a-zA-Z0-9_-]+)+$/i;            return EmailReg.test($.trim(email)) && (($.trim(email)).indexOf(' ') == -1);        }        //手机号码校验        function teleCheck(tel) {            // var telReg = /^1[3|4|5|8][0-9]\d{8}$/;            var telReg = /^1[0-9]\d{9}$/;            return telReg.test(tel);        }        //注册按钮灰化检查        function registerBtnCheck() {            if (emailCheck && passwordCheck  && checkboxCheck) {                //if (emailCheck && passwordCheck && telCheck && verifyCheck && checkboxCheck && geetestCheck) { 去掉手机验证                $('.account-regist-btn').removeClass('account-regist-btn-disabled');            }            else {                $('.account-regist-btn').addClass('account-regist-btn-disabled');            }        }        //密码复杂度判断        function passwordType(psw) {            //小写字母            var reg1 = /^((?![a-z]).)*$/;            //大写字母            var reg2 = /^((?![A-Z]).)*$/;            //数字            var reg3 = /^((?![0-9]).)*$/;            if ((!reg1.test(psw) && !reg2.test(psw)) ||                !reg1.test(psw) && !reg3.test(psw) ||                !reg2.test(psw) && !reg3.test(psw)) {                if (!reg1.test(psw) && !reg2.test(psw) && !reg3.test(psw)) {                    return 3;                } else {                    return 2;                }            } else {                return 1;            }        }        //密码复杂度提示 type: 0(不显示) 1(弱) 2(中) 3(强)        function passwordTip(type) {            if (type != 0) {                if (type == 1) {                    $('.password-type-con .password-type-btn:nth-child(1)').css('background', '#FF5B5B');                    $('.password-type-con .password-type-btn:nth-child(2)').css('background', '#EEE');                    $('.password-type-con .password-type-btn:nth-child(3)').css('background', '#EEE');                    $('.password-type-con .password-type-text').css('color', '#CCC');                    $('.password-type-con .password-type-text').html('弱');                } else if (type == 2) {                    $('.password-type-con .password-type-btn:nth-child(1)').css('background', '#F5A623');                    $('.password-type-con .password-type-btn:nth-child(2)').css('background', '#F5A623');                    $('.password-type-con .password-type-btn:nth-child(3)').css('background', '#EEE');                    $('.password-type-con .password-type-text').css('color', '#CCC');                    $('.password-type-con .password-type-text').html('中');                } else if (type == 3) {                    $('.password-type-con .password-type-btn:nth-child(1)').css('background', '#00B374');                    $('.password-type-con .password-type-btn:nth-child(2)').css('background', '#00B374');                    $('.password-type-con .password-type-btn:nth-child(3)').css('background', '#00B374');                    $('.password-type-con .password-type-text').css('color', '#00B374');                    $('.password-type-con .password-type-text').html('强');                }                $('.password-type-con').show();            } else {                $('.password-type-con').hide();            }        }        // init();    })</script>{/block}