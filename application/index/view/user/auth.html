{extend name="user-layout" /}{block name="content"}<div class="content-wrapper">    <div class="row">        {if condition="$auth.status eq 2"}        <div class="col-md-12 grid-margin stretch-card">            <div class="card">                <div class="card-body">                    <h4 class="card-title">认证信息</h4>                    <p class="card-description text-success">                        <i class="icon-check"></i>您已通过认证！                    </p>                    <table class="table table-borderless w-100 mt-4">                        <tbody>                        <tr>                            <td><strong> 姓  名 :</strong> {$auth.realname}</td>                        </tr>                        <tr>                            <td><strong>身份证号 :</strong> {:substr_replace($auth['sfznum'],'******',8,6)}</td>                        </tr>                        <tr>                            <td><strong>认证时间 :</strong> {$auth.update_time|date='Y-m-d H:i:s',###}</td>                        </tr>                        </tbody>                    </table>                </div>            </div>        </div>        {elseif condition="$auth.status eq 1" /}        <div class="col-md-12 grid-margin stretch-card bg-primary">            <div class="card">                <div class="card-body">                    <p class="card-text text-center text-info">                        <i class="icon-clock"></i>                        您已提交身份验证，请等待审核...                    </p>                </div>            </div>        </div>        {else /}        <div class="col-md-12 grid-margin stretch-card">            <div class="card">                <div class="card-body">                    <h4 class="card-title">认证信息</h4>                    {eq name="$auth.status" value="0"}                    <p class="card-description text-danger"><i class="icon-check"></i>认证失败！请重新填写您的个人信息</p>                    {else /}                    <p class="card-description">请认真填写您的个人认证信息,谢谢合作！</p>                    {/eq}                    <form class="layui-form forms-sample"  action="" method="post">                        <input type="text" name="i[id]" value="{$auth.id|default=''}" hidden disabled readonly >                        <input type="text" name="i[uid]" value="{$user_info.uid}" hidden disabled readonly >                        <div class="form-group row">                            <label for="UserName" class="col-sm-2 col-form-label">姓名</label>                            <div class="col-sm-9">                                <input type="text" name="i[realname]" value="马大哈" required lay-verify="required" class="form-control" id="UserName" placeholder="姓名">                            </div>                        </div>                        <div class="form-group row">                            <label for="exampleInputPassword2" class="col-sm-2 col-form-label">身份证号</label>                            <div class="col-sm-9">                                <input type="text" name="i[sfznum]" value="554612198802051515" required lay-verify="required|sfznum" class="form-control" id="exampleInputPassword2" placeholder="身份证号">                            </div>                        </div>                        <div class="form-group row">                            <label class="col-sm-2 col-form-label">身份证（头像）</label>                            <div class="col-sm-9">                                <input type="file" onChange="upload(this,'card_url_a')" class="dropify" data-allowed-file-extensions="jpg png jpeg" data-max-file-size="800kb" />                                <input type="hidden" id="card_url_a" value='' required lay-verify="required" name="i[card][]">                            </div>                        </div>                        <div class="form-group row">                            <label class="col-sm-2 col-form-label">身份证（国徽）</label>                            <div class="col-sm-9">                                <input type="file" onChange="upload(this,'card_url_b')" class="dropify" data-allowed-file-extensions="jpg png jpeg" data-max-file-size="800kb" />                                <input type="hidden" id="card_url_b" value='' required lay-verify="required" name="i[card][]">                            </div>                        </div>                        <div class="form-group row">                            <label class="col-sm-2 col-form-label"></label>                            <div class="col-sm-9">                                <button type="button" class="btn btn-primary btn-submit-userinfo btn-fw" lay-submit lay-filter="app-user-submitauth">提交认证</button>                            </div>                        </div>                    </form>                </div>            </div>        </div>        {/if}    </div></div>{/block}{block name="pagejs"}<script src="__STATIC__/cloudui/js/exif.js"></script><script src="__STATIC__/cloudui/js/mobileBUGFix.mini.js"></script><script>    layui.use(['form'], function(){        let $ = layui.$            ,form = layui.form;        //数据验证        form.verify({            sfznum: [/(^\d{15}$)|(^\d{17}(x|X|\d)$)/, "请输入正确的身份证号"]        });        //监听搜索        form.on('submit(app-user-submitauth)', function(data){            let field = data.field;            console.log(field);            //提交            $.ajax({                url:'{:url(\'index/User/auth\')}',                method:"POST",                data:field, success:function (res) {                    if (res.code == 1){setTimeout("location.reload();",1000);}                    showToast(res);                }            });        });        $('.dropify').dropify({            messages: {                'default': '点击或拖拽文件到这里',                'replace': '点击或拖拽文件到这里来替换文件',                'remove':  '移除文件',                'error':   '对不起，你上传的文件太大了',            },            error:{                fileSize:"文件大小超过 ({{ value }}).",                fileExtension:"文件类型不允许， ({{ value }})."            }        });    });    //图片上传事件    function upload(obj,o) {        ajax_upload_file(obj,o);    }    let image = new Image();    //ajax图片上传    function ajax_upload_file(obj,o) {        let fr = new FileReader();        fr.readAsDataURL(obj.files[0]);        EXIF.getData(obj.files[0], function() {            EXIF.getAllTags(this);            Orientation = EXIF.getTag(this, 'Orientation');        });        fr.onload = function () {            //裁剪            image.src = this.result;            let cvs = document.createElement('canvas');            image.onload = function() {                let max_width = 750, max_height = 480;                //如果   [宽/高]   >  [最大宽/高]                if (image.width / image.height >= max_width / max_height) {                    //如果 [宽]>[最大宽]                    if (image.width > max_width) {                        cvs.width = max_width;                        cvs.height = (image.height * max_width) / image.width;                    } else {                        cvs.width = image.width;                        cvs.height = image.height;                    }                } else {                    //如果 [高]>[最大高]                    if (image.height > max_height) {                        cvs.height = max_height;                        cvs.width = (image.width * max_height) / image.height;                    } else {                        cvs.width = image.width;                        cvs.height = image.height;                    }                }                //计算等比缩小后图片宽高                let mpImg = new MegaPixImage(image);                mpImg.render(cvs, {                    maxWidth: 750,                    maxHeight: 480,                    quality: 0.8,                    orientation: Orientation                });                let newImageData = cvs.toDataURL("image/jpeg", 0.8);                $.ajax({                    type: 'POST',                    url: "{:url('index/User/uploadAuth')}",                    data: {                        'pic': newImageData                    },                    dataType: 'json',                    success: function (resp) {                        $("#"+o).val(resp.data.src);                    }                });            };        }    };</script>{/block}