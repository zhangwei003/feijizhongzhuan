{extend name="index-layout" /}
{block name="content"}
<div class="layui-fluid">
    <div class="row">
        <div class="col-md-12 grid-margin stretch-card">
            <div class="card">
                <div class="card-body">
                    <h4 class="card-title">代付申请</h4>
                    <!--<p class="card-description text-danger">注： 一天仅允许提现一次哟！</p>-->
                    <ul class="nav nav-tabs tab-basic" role="tablist">
                        <li class="nav-item">
                            <a class="nav-link active" id="apply-tab" data-toggle="tab" href="#apply" role="tab" aria-controls="apply" aria-selected="true"><i class="icon-wallet"></i>代付申请</a>
                        </li>
                    </ul>
                    <div class="tab-content tab-content-basic">
                        <div class="tab-pane fade show active" id="apply" role="tabpanel" aria-labelledby="apply-tab">
                            <form class="layui-form forms-sample" action="" method="post">
                                <!----表单令牌防重复防跨站----->
                                {:token()}
                                <input name="b[uid]" value="{$info.uid}" hidden disabled readonly>
                                <div class="form-group row">
                                    <label class="col-sm-2 col-form-label">可代付金额</label>
                                    <div class="col-sm-9">
                                        <input type="text" value="{$info.enable}" class="form-control" id="enable" readonly>
                                    </div>
                                </div>
                                <div class="form-group row">
                                    <label for="amount" class="col-sm-2 col-form-label">代付金额</label>
                                    <div class="col-sm-9">
                                        <input type="text" name="b[amount]" value="" required lay-verify="required|vernum" class="form-control" minlength="2" maxlength="6" id="amount" placeholder="代付金额">
                                    </div>
                                </div>

                                <!--<div class="form-group row">-->
                                <!--<label for="bank_code" class="col-sm-2 col-form-label">银行编码</label>-->
                                <!--<div class="col-sm-9">-->
                                <!--<input type="text" name="b[bank_code]" value="" required lay-verify="required" class="form-control" minlength="2" maxlength="10" id="bank_code" placeholder="银行编码">-->
                                <!--</div>-->
                                <!--</div>-->
                                <div class="form-group row">
                                    <label class="col-sm-2 col-form-label">选择银行</label>
                                    <div class="col-sm-9">
                                        <select name="b[bank_code]" required lay-verify="required" class="form-control">
                                            <option value="">请选择银行</option>
                                            {volist name="banker" id="vo"}
                                            <option value="{$vo.bank_code}" {$vo.default ? 'selected':''}>{$vo.name}</option>
                                            {/volist}
                                        </select>
                                    </div>
                                </div>


                                <div class="form-group row">
                                    <label for="bank_number" class="col-sm-2 col-form-label">银行卡号</label>
                                    <div class="col-sm-9">
                                        <input type="text" name="b[bank_number]" value="" required lay-verify="required" class="form-control" minlength="2" maxlength="20" id="bank_number" placeholder="银行卡号">
                                    </div>
                                </div>


                                <div class="form-group row">
                                    <label for="bank_owner" class="col-sm-2 col-form-label">真实姓名</label>
                                    <div class="col-sm-9">
                                        <input type="text" name="b[bank_owner]" value="" required lay-verify="required" class="form-control" minlength="2" maxlength="10" id="bank_owner" placeholder="真实姓名">
                                    </div>
                                </div>




                                <div class="form-group row">
                                    <label class="col-sm-2 col-form-label">备注</label>
                                    <div class="col-sm-9">
                                        <textarea type="text" name="b[body]" class="form-control" rows="3"></textarea>
                                    </div>
                                </div>

                                {if condition="$user['is_need_google_verify']"}
                                <div class="form-group row">
                                    <label for="google_code" class="col-sm-2 col-form-label">验证码</label>
                                    <div class="col-sm-9">
                                        <input type="text" name="b[google_code]" value="" required lay-verify="required" class="form-control" minlength="2" maxlength="8" id="google_code" placeholder="请使用google身份验证器扫描下方二维码获取最新的验证码,并输入">
                                    </div>
                                </div>

                                <div class="form-group row">
                                    <label class="col-sm-2 col-form-label"></label>
                                    <div class="col-sm-9">
                                        <img title="请使用google身份验证器扫描此二维码进行身份验证" src='{$google_qr}'>
                                    </div>
                                </div>
                                {/if}
                                <div class="form-group row">
                                    <label class="col-sm-2 col-form-label"></label>
                                    <div class="col-sm-9">
                                        <button type="button" class="btn btn-success btn-submit-balance-apply btn-fw" lay-submit lay-filter="app-balance-apply-submit">提交申请</button>
                                    </div>
                                </div>
                            </form>
                        </div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script>layui.use(['form', 'layer','jquery'],
    function() {
        $ = layui.jquery;
        var form = layui.form,
            layer = layui.layer;



        //监听提现计算
        $('#amount').bind('input propertychange', function() {
            //let amount = $('#amount').val();

            //$('#fee').val(amount*(2/1000));
        });

        //数据验证
        form.verify({
            vernum: function(v) {
                if (v * 100 > $("#enable").val()* 100) return "代付金额大于可用金额！";
                if ( 100 > v * 10) return "满10元才可代付哟！";
            }
        });

        //监听提现提交
        form.on('submit(app-balance-apply-submit)', function(data){
            let field = data.field;
            console.log(field);
            //提交
            $.post("{:url('index/daifu_order/apply')}",field,function (res) {
                if (res.code == 1){setTimeout("location.reload();",1000);}
                layer.alert(res.msg);
            })
        });
    });</script>
{/block}
{block name="pagejs"}

s
